# KeyScore Extractor

バンドスコアPDFからキーボード・ピアノパートを自動的に抽出するウェブアプリケーション

## 概要

KeyScore Extractorは、バンドスコアのPDFファイルをアップロードするだけで、自動的にキーボード/ピアノパートを検出し、見やすく整理されたPDFとして出力するツールです。

## 主な機能

- **自動パート検出**: PDFから自動的にキーボード、ボーカル、コードパートを識別
- **小節単位の整理**: 4小節または8小節単位で美しく整列
- **複数パート対応**: ボーカル、コード、キーボードを選択的に抽出
- **歌詞表示オプション**: ボーカルパートに歌詞を含めるかを選択可能
- **スマート抽出**: ベースやギターを除外し、必要なパートのみを抽出

## 動作環境

- Python 3.8以上
- 対応ブラウザ: Chrome, Firefox, Safari, Edge（最新版）

## インストール方法

1. リポジトリをクローン
```bash
git clone https://github.com/yourusername/band_part_key_app.git
cd band_part_key_app
```

2. 仮想環境を作成して有効化
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

3. 依存パッケージをインストール
```bash
pip install -r requirements.txt
```

4. アプリケーションを起動
```bash
python app.py
```

5. ブラウザで http://localhost:5003 にアクセス

## 使い方

1. **PDFをアップロード**
   - 「ファイルを選択」ボタンをクリックまたはドラッグ&ドロップ
   - 最大ファイルサイズ: 50MB

2. **抽出設定を選択**
   - **抽出モード**: スマート抽出（推奨）、パートのみ、またはページ全体
   - **パート選択**: ボーカル、コード、キーボードから必要なものを選択
   - **小節数**: 4小節（詳細表示）または8小節（コンパクト表示）
   - **歌詞表示**: ボーカルパートに歌詞を含めるかを選択

3. **抽出実行**
   - 「キーボードパートを抽出」ボタンをクリック
   - 処理完了後、自動的にPDFがダウンロードされます

## 技術仕様

### バックエンド
- Flask (Python Webフレームワーク)
- PyMuPDF (PDFの読み書き)
- OpenCV (画像処理)
- Tesseract OCR (文字認識)

### フロントエンド
- Bootstrap 5 (UIフレームワーク)
- Font Awesome (アイコン)
- Vanilla JavaScript

### 主要コンポーネント
- `app.py`: FlaskアプリケーションのメインAPI
- `core/measure_based_extractor.py`: 小節ベースの楽譜抽出エンジン
- `core/pdf_processor.py`: PDF処理の基本機能
- `templates/index.html`: ウェブインターフェース
- `static/js/app.js`: フロントエンドロジック

## 設定

`config.py`で以下の設定を変更できます：
- `UPLOAD_FOLDER`: アップロードファイルの保存先
- `MAX_CONTENT_LENGTH`: 最大ファイルサイズ（デフォルト: 50MB）
- `SECRET_KEY`: セッション管理用のシークレットキー

## トラブルシューティング

### コードパートが表示されない
- PDFにコードパート（Ch. または Chord）が含まれているか確認してください
- スマート抽出モードでコードパートにチェックが入っているか確認してください

### 4小節/8小節表示が正しく動作しない
- ブラウザのキャッシュをクリアして再度お試しください
- 楽譜の小節線が明確に見える高品質なPDFを使用してください

### 歌詞が表示されない
- 「ボーカルパートに歌詞を表示」オプションがチェックされているか確認してください
- ボーカルパートが選択されているか確認してください

## ライセンス

MIT License

## 貢献

プルリクエストを歓迎します。大きな変更を行う場合は、まずissueを作成して変更内容について議論してください。

## 作者

[Your Name]

---

KeyScore Extractorで、バンド練習をもっと効率的に！